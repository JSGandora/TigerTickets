<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">TigerTickets</a>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li style="border-bottom: 2px solid red;bottom: 0;width: 100px;">
                    <a href="#" style="color:white">My Tickets</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">

    <!-- Page Features -->
    <div class="row text-center", id="profile-page">

        <!-- /.row -->

        <hr>
        
        <!-- Footer -->
        <footer>
            <div class="row">
                <div class="col-lg-12">
                    <p>Copyright &copy; TigerTickets 2017</p>
                </div>
            </div>
        </footer>

    </div>
    <!-- /.container -->

    <!-- Buy Modal -->
    <div id="confirm-delete" class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

        <!-- Modal content -->
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="close" data-dismiss="modal">&times;</span>
                    <h2></h2>
                </div>
                <div class="modal-body">
                    <h1>Delete Ticket Request?</h1>
                    <p> You are about to delete your ticket request for: </p>
                    <p id="deletionBody">ya done goof'd</p>
                    <p> This procedure is irreversible.</p>
                    <p><strong>Do you want to proceed?</strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <a id = "deleteButton" class="btn btn-danger btn-ok" data-dismiss="modal" >Delete</a>
                </div>
            </div>
        </div>

    </div>

    <script>
<!-- Generate Buy Data -->
    var allData = {"requests" : [] }
    $.get('my-tix-data', function(response) { 
        allData = response
        if ($.isReady) {
          updateRequests()
        } else {
          $(function() { updateRequests() })
        }
      })

    function addZero(i) {
        if (i < 10) {
            i = "0" + i;
        }
        return i;
    }

    var weekday = new Array(7);
      weekday[0] =  "Sunday";
      weekday[1] = "Monday";
      weekday[2] = "Tuesday";
      weekday[3] = "Wednesday";
      weekday[4] = "Thursday";
      weekday[5] = "Friday";
      weekday[6] = "Saturday";

      var monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
      ];

    var buyRequests_html = ""
    var sellRequests_html = ""
    function updateRequests() {
        buyRequests_html = ""
        sellRequests_html = ""
        for (i = 0; i < allData["buyrequests"].length; i++) {
            var buyRequestStatus = allData["buyrequests"][i]["status"]
            var show = allData["buyrequests"][i]["show"]

            var date = new Date(0)
            date.setUTCSeconds(show['time'])

            var weekDay = weekday[date.getDay()]
            var month = monthNames[date.getMonth()]
            var dayOfMonth = date.getDate()
            var year = date.getFullYear()
            var hour = date.getHours() % 12 // Convert from the 24h format.
            var ampm = Math.floor(date.getHours() / 12) == 0 ? 'AM' : 'PM'
            var min = addZero(date.getMinutes());
            var time = hour+":"+min+" "+ampm;
            var btime = hour+":"+min+" "+ampm+" "+weekDay+"<br>"+month+" "+dayOfMonth+", "+year

            var bloc = show["location"]
            var bgroup = show["group"]

            buyRequests_html += "<div class='row' id='buying"+i+"'>"+
                    "<div class='col-md-2'>"+
                        "<a href='#'>" +
                            "<img class = 'center-block' src="+show["image"]+" alt=''>"+
                        "</a>"+
                    "</div>"+
                    "<div class='col-md-3'>"+
                        "<h3>"+show["name"]+"</h3>"+
                    "</div>"+
                    "<div class='col-md-5'>"+
                        "<h4>"+btime+"</h4>"+
                        "<h4>"+bloc+"</h4>"+
                        "<h4>"+bgroup+"</h4>"+
                    "</div>"+
                    "<div class='col-md-2'>"+
                        "<button class='btn btn-primary' data-target='#confirm-delete' data-toggle='modal' id = 'deleteBuying"+i+"'>Delete <span class='glyphicon'></span></button>"+
                    "</div>"+
                "</div>"+
            "<hr>"
        }
        $("#buy-requests-html-span").html(buyRequests_html)

        for (i = 0; i < allData["sellrequests"].length; i++) {
            var sellRequestStatus = allData["sellrequests"][i]["status"]
            show = allData["sellrequests"][i]["show"]

            var date = new Date(0)
            date.setUTCSeconds(show['time'])

            var weekDay = weekday[date.getDay()]
            var month = monthNames[date.getMonth()]
            var dayOfMonth = date.getDate()
            var year = date.getFullYear()
            var hour = date.getHours() % 12 // Convert from the 24h format.
            var ampm = Math.floor(date.getHours() / 12) == 0 ? 'AM' : 'PM'
            var min = addZero(date.getMinutes());
            var time = hour+":"+min+" "+ampm;
            var btime = hour+":"+min+" "+ampm+" "+weekDay+"<br>"+month+" "+dayOfMonth+", "+year

            var bloc = show["location"]
            var bgroup = show["group"]

            sellRequests_html += "<div class='row' id='buying"+i+"'>"+
                    "<div class='col-md-2'>"+
                        "<a href='#'>" +
                            "<img class = 'center-block' src="+show["image"]+" alt=''>"+
                        "</a>"+
                    "</div>"+
                    "<div class='col-md-3'>"+
                        "<h3>"+show["name"]+"</h3>"+
                    "</div>"+
                    "<div class='col-md-5'>"+
                        "<h4>"+btime+"</h4>"+
                        "<h4>"+bloc+"</h4>"+
                        "<h4>"+bgroup+"</h4>"+
                    "</div>"+
                    "<div class='col-md-2'>"+
                        "<button class='btn btn-primary' data-target='#confirm-delete' data-toggle='modal' id = 'deleteBuying"+i+"'>Delete <span class='glyphicon'></span></button>"+
                    "</div>"+
                "</div>"+
            "<hr>"
        }
        $("#sell-requests-html-span").html(sellRequests_html)
    }



    var buyData = {
    "buy-tickets": [
        {
          "Name": "Student Playwrights Festival",
          "Group": "Theatre Intime",
          "Time": "2:00 PM",
          "Date": "Saturday, April 01, 2017",
          "Location": "Hamilton Murray Theater, Princeton",
          "Image": "https://tickets.princeton.edu/ArticleMedia/Images/Intime%202016-2017.jpg",
          "BuyReq": 6,
          "SellReq": 0,
          "Price": 8
        },
        {
          "Name": "No Me Digas!",
          "Group": "Mas Flow Dance Company",
          "Time": "6:00 PM",
          "Date": "Saturday, April 01, 2017",
          "Location": "Frist Theatre",
          "Image": "https://tickets.princeton.edu/ArticleMedia/Images/Mas%20Flow%201.jpg",
          "BuyReq": 0,
          "SellReq": 3,
          "Price": 8
        }
      ]
    }
    <!-- Generate Sell Data -->
    var sellData = {
    "sell-tickets": [
        {
          "Name": "50 Years Muslim Life @ Princeton",
          "Group": "Muslim Alumni Event 2017",
          "Time": "11:00 AM",
          "Date": "Saturday, April 01, 2017",
          "Location": "Carl A. Fields Center",
          "Image": "https://tickets.princeton.edu/ArticleMedia/Images/Muslim%20Alumni%20Event.jpg",
          "BuyReq": 0,
          "SellReq": 5,
          "Price": 8
        }
      ]
    }
    <!-- Generate Buying Script for Ticket Requests -->
    var buying_html = ""
    for (i = 0; i < buyData["buy-tickets"].length; i++){
        var btime = buyData["buy-tickets"][i]["Date"]+" "+buyData["buy-tickets"][i]["Time"]
        var bloc = buyData["buy-tickets"][i]["Location"]
        var bgroup = buyData["buy-tickets"][i]["Group"]
        buying_html += "<div class='row' id='buying"+i+"'>"+
                    "<div class='col-md-2'>"+
                        "<a href='#'>" +
                            "<img class = 'center-block' src="+buyData["buy-tickets"][i]["Image"]+" alt=''>"+
                        "</a>"+
                    "</div>"+
                    "<div class='col-md-3'>"+
                        "<h3>"+buyData["buy-tickets"][i]["Name"]+"</h3>"+
                    "</div>"+
                    "<div class='col-md-5'>"+
                        "<h4>"+btime+"</h4>"+
                        "<h4>"+bloc+"</h4>"+
                        "<h4>"+bgroup+"</h4>"+
                    "</div>"+
                    "<div class='col-md-2'>"+
                        "<button class='btn btn-primary' data-target='#confirm-delete' data-toggle='modal' id = 'deleteBuying"+i+"'>Delete <span class='glyphicon'></span></button>"+
                    "</div>"+
                "</div>"+
            "<hr>"
    }
    <!-- Generate Selling Script for Ticket Requests -->
    var selling_html = ""
    for (i = 0; i < sellData["sell-tickets"].length; i++){
        var stime = sellData["sell-tickets"][i]["Date"]+" "+sellData["sell-tickets"][i]["Time"]
        var sloc = sellData["sell-tickets"][i]["Location"]
        var sgroup = sellData["sell-tickets"][i]["Group"]
        selling_html += "<div class='row' id='selling"+i+"'>"+
                    "<div class='col-md-2'>"+
                        "<a href='#'>" +
                            "<img class = 'center-block' src="+sellData["sell-tickets"][i]["Image"]+" alt=''>"+
                        "</a>"+
                    "</div>"+
                    "<div class='col-md-3'>"+
                        "<h3>"+sellData["sell-tickets"][i]["Name"]+"</h3>"+
                    "</div>"+
                    "<div class='col-md-5'>"+
                        "<h4>"+stime+"</h4>"+
                        "<h4>"+sloc+"</h4>"+
                        "<h4>"+sgroup+"</h4>"+
                    "</div>"+
                    "<div class='col-md-2'>"+
                        "<button class='btn btn-primary' data-target='#confirm-delete' id='deleteSelling"+i+"' data-toggle='modal'>Delete <span class='glyphicon'></span></button>"+
                    "</div>"+
                "</div>"+
            "<hr>"
    }
    profile = "<div class='row text-left'>"+
            "<div class='col-lg-12'>"+
                "<h3>Ticket Buy Requests</h3>"+
            "</div>"+
        "</div>"+
        "<hr>"+

        "<span id='buy-requests-html-span'>" +
        buyRequests_html +
        "</span>" +
        "<div class='row text-left'>"+
            "<div class='col-lg-12'>"+
                "<h3>Ticket Sell Requests</h3>"+
            "</div>"+
        "</div>"+
        "<hr>"+
        "<span id='sell-requests-html-span'>" +
        sellRequests_html +
        "</span>"
        deletionId = 0
        
        $(document).ready(function(){
            $("#profile-page").html(profile)
            for (i = 0; i < sellData["sell-tickets"].length; i++) {
                (function(index) {$("#deleteSelling" + i).click(function(){
                    deletionId = "selling" + index
                    message = "<p><strong>" + sellData["sell-tickets"][index]["Name"] + "<br />" + sellData["sell-tickets"][index]["Date"] + " " + sellData["sell-tickets"][index]["Time"] + "<br />" + sellData["sell-tickets"][index]["Location"] + "</strong>.</p>";
                    $("#deletionBody").html(message)
                    });
                })(i);
            }
            $("#deleteButton").on('click', function(e){
                $("#" + deletionId).replaceWith("<p>Request deleted.</p>")
            });
            for (i = 0; i < buyData["buy-tickets"].length; i++) {
                (function(index) {$("#deleteBuying" + i).click(function(){
                    deletionId = "buying" + index
                    message = "<p><strong>" + buyData["buy-tickets"][index]["Name"] + "<br />" + buyData["buy-tickets"][index]["Date"] + " " + buyData["buy-tickets"][index]["Time"] + "<br />" + buyData["buy-tickets"][index]["Location"] + "</strong>.</p>";
                    $("#deletionBody").html(message)
                    });
                })(i);
            }
            $("#deleteButton").on('click', function(e){
                $("#" + deletionId).replaceWith("<p>Request deleted.</p>")
            });
        });
</script>
